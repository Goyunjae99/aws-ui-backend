# 실행 및 테스트 방법

## 단계별 실행 방법 (요약)

1. **의존성 설치**  
   pip install -r requirements.txt  
   (필요 시 `pip install cryptography`)

2. **서버 실행**  
   `python main.py`  
   → 브라우저에서 **http://localhost:8000** 접속

- PostgreSQL이 없어도 **앱이 죽지 않습니다.**  
  연결 실패 시 콘솔에 `DB 연결 실패 → SQLite로 임시 전환` 이 출력되고,  
  로컬 파일 `app.db`(SQLite)로 자동 폴백하여 서버가 계속 동작합니다.

---

## 1. 사전 준비

- Python 3.x 설치
- 프로젝트 루트에서 작업
- **(선택)** PostgreSQL 사용 시: `main.py` 내 `SQLALCHEMY_DATABASE_URL` 이 접속 가능한 주소여야 함.  
  사용하지 않으면 SQLite(`app.db`)로 자동 전환됨.

## 2. 의존성 설치

```bash
cd c:\Users\soldesk\Downloads\public_version_(2)
pip install -r requirements.txt
```

필요 시: `cryptography` 가 없다면 `pip install cryptography` 실행.

## 3. 서버 실행

```bash
python main.py
```

또는:

```bash
uvicorn main:app --host 0.0.0.0 --port 8000
```

- PostgreSQL 연결이 되면 해당 DB 사용, **실패 시 자동으로 SQLite(`./app.db`)로 전환**되며 콘솔에 메시지가 출력됩니다.  
기본 주소: **http://localhost:8000**

## 4. API 테스트

### 4-1. Provisioning 시작 (Mock 비동기)

POST 한 번 보내면 즉시 응답이 오고, 백그라운드에서 Mock 작업이 진행됩니다.

**PowerShell:**

```powershell
Invoke-RestMethod -Uri "http://localhost:8000/api/provision" -Method POST -ContentType "application/json" -Body '{"serviceName":"TestSvc","userName":"admin","config":{"template":"standard"},"targetInfra":{}}'
```

**curl (Git Bash 등):**

```bash
curl -X POST http://localhost:8000/api/provision -H "Content-Type: application/json" -d "{\"serviceName\":\"TestSvc\",\"userName\":\"admin\",\"config\":{\"template\":\"standard\"},\"targetInfra\":{}}"
```

**기대 응답 예시:**

```json
{"status":"success","message":"프로젝트 #1 생성 시작","project_id":1}
```

몇 초 후 DB에 해당 프로젝트의 `status`, `details.logs`, `details.resources` 가 채워집니다.

### 4-2. History 조회

```powershell
Invoke-RestMethod -Uri "http://localhost:8000/api/history" -Method GET
```

또는 브라우저에서 **http://localhost:8000/history** 접속 후 테이블에서 상태·IP·로그 등 확인.

### 4-3. Monitoring (내 리소스) 조회

```powershell
Invoke-RestMethod -Uri "http://localhost:8000/api/monitoring/my-resources" -Method GET
```

Mock 완료된 프로젝트는 ALB, Web, DB, SSH 항목으로 목록에 나타납니다.

### 4-4. 프로젝트 삭제

```powershell
Invoke-RestMethod -Uri "http://localhost:8000/api/provision/1" -Method DELETE
```

`1` 은 삭제할 프로젝트 ID로 바꿉니다.

## 5. UI로 확인

1. 브라우저에서 **http://localhost:8000** 접속
2. Provisioning 화면에서 서비스명·설정 입력 후 **Start Provisioning** 클릭
3. **History** 페이지에서 해당 프로젝트가 PENDING → RUNNING → COMPLETED 로 바뀌는지 확인
4. **Monitoring** 페이지에서 리소스(ALB, Web, DB 등)가 보이는지 확인

## 6. 문제 발생 시

- **DB 연결 오류**: PostgreSQL을 쓰려면 `main.py` 의 `SQLALCHEMY_DATABASE_URL` 이 실제 주소/포트/계정과 일치해야 함.  
  PostgreSQL을 쓰지 않아도 됨 — 연결 실패 시 SQLite로 자동 전환되므로 로컬에서는 그대로 실행 가능.
- **모듈 없음**: `pip install -r requirements.txt` 및 `pip install cryptography` 재실행
- **포트 사용 중**: 다른 포트 사용 시 `uvicorn main:app --port 8001` 처럼 `--port` 로 변경
